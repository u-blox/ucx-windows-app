# Release Process for ucx-windows-app

## Overview

Releases are **GitHub-only** with signed executables. Users clone the repository to build Debug or custom configurations.

## Version Numbering

**Automatic versioning** based on Git commit count:
- Format: `3.2.0.BUILD` where BUILD = git commit count
- Example: `3.2.0.257` (257 commits in repository)
- Major.Minor.Patch follows UCX API version (currently 3.2.0)
- Build number auto-increments with each commit

Version is generated at build time by CMake from `ucx-windows-app/version.h.in`.

## Creating a Release

### 1. Ensure Code is Ready
- [ ] All features tested and working
- [ ] Compiler warnings fixed
- [ ] Documentation updated
- [ ] All changes committed to Git

### 2. Build and Sign Release

**Important:** Always clean build before release to ensure correct version number:

```powershell
# Clean rebuild Release configuration (forces version regeneration)
.\launch-ucx-windows-app.cmd rebuild

# Build Release configuration and sign with certificate
.\launch-ucx-windows-app.cmd sign EF3FD135F1CD...

# This will:
# - Count Git commits and generate version.h (3.2.0.XXX where XXX = commit count)
# - Build Release configuration
# - Sign with u-blox AG GlobalSign EV CodeSigning certificate
# - Timestamp with DigiCert server (valid until Dec 2027)
# - Verify signature and certificate chain
# - Create ucx-windows-app-signed.exe in ucx-windows-app/release/
```

**Verify Version Before Release:**
```powershell
# Check the version number displayed in CMake output
# Should show: "Build version: 3.2.0.XXX (Git commit count)"

# Or run the executable to verify
.\examples\ucx-windows-app\release\ucx-windows-app-signed.exe
# Menu header should show: "Application v3.2.0.XXX"
```

**Note:** The signed executable has ftd2xx64.dll embedded as a resource - no separate DLL needed.

### 3. Create Git Tag
```bash
# Tag format: v3.2.0.BUILD
git tag -a v3.2.0.257 -m "Release ucx Windows App v3.2.0.257"
git push origin master
git push origin v3.2.0.257
```

### 4. Create GitHub Release
1. Go to: https://github.com/u-blox/ucx-windows-app/releases
2. Click "Draft a new release"
3. **Tag:** v3.2.0.257 (must match Git tag)
4. **Title:** ucx-windows-app v3.2.0.257
4. **Description:** Write release notes including:
   ```markdown
   ## Features
   - Bluetooth: Scan, connect, GATT client/server, SPS
   - Wi-Fi: Station/AP mode, HTTP, MQTT, NTP, location services
   - Firmware update via XMODEM with SHA256 verification
   - Note: HID over GATT (HoG) keyboard is experimental
   
   ## Requirements
   - Windows 10/11 (64-bit)
   - NORA-W36 or NORA-B26 module
   - USB connection (auto-detects EVK boards)
   
   ## SHA256 Checksum
   sha256:PASTE_HASH_HERE_AFTER_CALCULATING
   
   ## Installation
   Download ucx-windows-app-signed.exe and run - no installation required.
   FTDI drivers are embedded in the executable.
   ```
6. **Attach file:** `ucx-windows-app-signed.exe` (from ucx-windows-app/release/)
7. **Calculate SHA256** and add to release notes:
   ```powershell
   Get-FileHash ucx-windows-app\release\ucx-windows-app-signed.exe -Algorithm SHA256
   ```
8. Click "Publish release"

## After Release

Users who need Debug builds or modifications:
```bash
# Clone repository with submodule
git clone --recurse-submodules https://github.com/u-blox/ucx-windows-app.git
cd ucx-windows-app

# Build and run (auto-builds if needed)
.\launch-ucx-windows-app.cmd

# Build Debug configuration
.\launch-ucx-windows-app.cmd debug

# Build all configurations
.\launch-ucx-windows-app.cmd all
```

## Directory Structure

```
ucx-windows-app/
├── launch-ucx-windows-app.cmd              (Launch script)
├── ucx-windows-app.ini                     (Settings, auto-created, gitignored)
├── ucx-windows-app/
│   ├── ucx-windows-app.c               (Main application ~25,000 lines)
│   ├── ucx-windows-app.rc              (Resource file - icon, DLL, version)
│   ├── version.h.in                    (Version template)
│   ├── CMakeLists.txt                  (Build configuration)
│   ├── bin/
│   │   ├── ucx-windows-app.exe         (Release, unsigned, gitignored)
│   │   └── ucx-windows-app-debug.exe   (Debug, gitignored)
│   └── release/
│       └── ucx-windows-app-signed.exe  (Signed release, tracked in git)
├── ucxclient/                              (Git submodule)
│   ├── src/                            (UCX client library source)
│   ├── inc/                            (UCX client library headers)
│   └── ucx_api/                        (UCX API definitions)
└── build/
    ├── ucx-windows-app.sln                 (Visual Studio solution)
    ├── ucx-windows-app.vcxproj             (Visual Studio project)
    └── version.h                        (Generated by CMake, gitignored)
```

**Only signed releases** go to GitHub. Everything else is built from source.

## Release Checklist

- [ ] All tests passing
- [ ] Version reflects current commit count
- [ ] Built and signed with certificate
- [ ] SHA256 hash calculated and added to release notes
- [ ] Git tag created and pushed
- [ ] GitHub release created with signed executable
- [ ] Release notes include SHA256 hash in format: `sha256:HASH`

